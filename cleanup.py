# cleanup.py - Ø¶Ø¹Ù‡ ÙÙŠ Ø§Ù„Ø¬Ø°Ø± Ù…Ø¤Ù‚ØªØ§Ù‹
"""
Ø³ÙƒØ±ÙŠØ¨Øª ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ÙƒØ±Ø±Ø© ÙˆØ§Ù„Ù‚Ø¯ÙŠÙ…Ø©
"""
import os
import shutil
from pathlib import Path

def main():
    """ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ÙƒØ±Ø±Ø©"""
    
    print("ğŸ§¹ Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªÙ†Ø¸ÙŠÙ...")
    
    # 1. Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯ scripts Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
    os.makedirs("scripts", exist_ok=True)
    print("ğŸ“ ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯ scripts")
    
    # 2. Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯Ø§Øª app Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø©
    app_folders = [
        "app",
        "app/models", 
        "app/schemas",
        "app/routers",
        "app/services",
        "app/utils"
    ]
    
    for folder in app_folders:
        os.makedirs(folder, exist_ok=True)
        print(f"ğŸ“ ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯: {folder}")
    
    # 3. Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„ÙØ§Øª __init__.py Ø§Ù„ÙØ§Ø±ØºØ©
    init_files = [
        "app/__init__.py",
        "app/models/__init__.py", 
        "app/schemas/__init__.py",
        "app/routers/__init__.py",
        "app/services/__init__.py",
        "app/utils/__init__.py"
    ]
    
    for init_file in init_files:
        if not os.path.exists(init_file):
            with open(init_file, 'w') as f:
                f.write("# Generated by cleanup script\n")
            print(f"ğŸ“„ ØªÙ… Ø¥Ù†Ø´Ø§Ø¡: {init_file}")
    
    # 4. Ù†Ù‚Ù„ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø£Ù…Ø§ÙƒÙ†Ù‡Ø§ Ø§Ù„ØµØ­ÙŠØ­Ø©
    file_moves = []
    
    # ÙØ­Øµ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© ÙˆÙ†Ù‚Ù„Ù‡Ø§
    if os.path.exists("init_db.py"):
        file_moves.append(("init_db.py", "scripts/init_db.py"))
    
    if os.path.exists("reset_db.py"):
        file_moves.append(("reset_db.py", "scripts/reset_db.py"))
        
    if os.path.exists("migrate.py"):
        file_moves.append(("migrate.py", "scripts/migrate.py"))
        
    if os.path.exists("reset_users.py"):
        file_moves.append(("reset_users.py", "scripts/reset_users.py"))
    
    # ØªÙ†ÙÙŠØ° Ø§Ù„Ù†Ù‚Ù„
    for src, dst in file_moves:
        try:
            shutil.move(src, dst)
            print(f"ğŸ“¦ ØªÙ… Ù†Ù‚Ù„: {src} â†’ {dst}")
        except Exception as e:
            print(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ù†Ù‚Ù„ {src}: {e}")
    
    # 5. Ø­Ø°Ù Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ÙƒØ±Ø±Ø© Ø¥Ø°Ø§ ÙˆØ¬Ø¯Øª
    files_to_check = ["models.py", "schemas.py", "utils.py"]
    
    for file_path in files_to_check:
        if os.path.exists(file_path):
            # Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹
            backup_name = f"{file_path}.backup"
            shutil.copy2(file_path, backup_name)
            print(f"ğŸ’¾ ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©: {backup_name}")
            
            # Ø­Ø°Ù Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø£ØµÙ„ÙŠ
            os.remove(file_path)
            print(f"ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù: {file_path}")
    
    print("\nâœ… Ø§Ù†ØªÙ‡Øª Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø£ÙˆÙ„ÙŠØ©!")
    print("\nğŸ“‹ Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªØ§Ù„ÙŠØ©:")
    print("1. Ø§Ù†Ø³Ø® Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù…Ù† Ø§Ù„Ù€ artifacts")
    print("2. Ù‚Ù… Ø¨Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ù„Ù .env")
    print("3. Ø´ØºÙ„: python scripts/init_db.py")
    
    # 6. Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù .env Ù…Ø«Ø§Ù„ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
    if not os.path.exists(".env") and not os.path.exists(".env.example"):
        env_content = """# Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ©
SECRET_KEY=your-super-secret-key-here
DATABASE_URL=sqlite:///./app.db
DEBUG=True

# Google OAuth
GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret

# Salla API
SALLA_CLIENT_ID=your-salla-client-id
SALLA_CLIENT_SECRET=your-salla-client-secret

# OpenAI
OPENAI_API_KEY=your-openai-api-key

# DataForSEO
DATAFORSEO_LOGIN=your-dataforseo-login
DATAFORSEO_PASSWORD=your-dataforseo-password

# Frontend URL
FRONTEND_URL=http://localhost:3000
"""
        with open(".env.example", 'w', encoding='utf-8') as f:
            f.write(env_content)
        print("ğŸ“„ ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ .env.example")

if __name__ == "__main__":
    main()